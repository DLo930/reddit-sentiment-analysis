// Contract exploit: just makes four copies, doesn't reflect

pixel[] reflect(pixel[] pixels, int width, int height) 
//@requires is_valid_imagesize(width, height);
//@requires is_valid_imagesize(2*width, 2*height);
//@requires \length(pixels) == height * width;
//@ensures \length(\result) == (2*height) * (2*width);
{
  pixel[] res = alloc_array(pixel, height * width * 4);
  for (int r = 0; r < height; r++)
  {
    for (int c = 0; c < width; c++)
    {
      pixel p = pixels[get_index(r,c,width,height)];

      res[get_index(r,          c, 2*width, 2*height)] = p;
      res[get_index(r,          width + c, 2*width, 2*height)] = p;
      res[get_index(height + r, width + c, 2*width, 2*height)] = p;
      res[get_index(height + r, width + c, 2* width, 2*height)] = p;
    }
  }
  return res;
}

