/*
 * Doslingos - correct (?!?!!!?!) reference solution
 *
 */

bool all_distinct(string[] A, int n)
//@requires n == \length(A);
{
  return no_dupes(A, 0, n);
}

int count_vocab(string[] vocab, int[] freq, int v,
                string tweetfile,
                bool fast)
//@requires v == \length(vocab) && v == \length(freq);
//@requires is_sorted(vocab, 0, v);
//@requires all_distinct(vocab, v);
{
  bundle_t bund = read_words(tweetfile);
  int len = string_bundle_length(bund);
  string[] tweets = string_bundle_array(bund);
  //@assert \length(tweets) == len;

  // Keep track of out-of-vocabulary words
  int oov = 0;

  for(int i = 0; i < len; i++)
    //@loop_invariant 0 <= i;
    {
      // Get index in vocabulary
      int j;
      if(fast) j = binsearch(tweets[i], vocab, v);
      else j = linsearch(tweets[i], vocab, v);

      // Update the appropriate frequency count
      if (j == -1) oov += 1;
      else freq[j] += 1;
    }

  return oov;
}

void sekret_obfuscate_merge(int[] A, string[] S, int lower, int mid, int upper)
//@requires 0 <= lower && lower < mid && mid < upper && upper <= \length(A);
//@requires is_sorted_int(A, lower, mid) && is_sorted_int(A, mid, upper);
//@ensures is_sorted_int(A, lower, upper);
{
  int[] B = alloc_array(int, upper-lower);
  string[] T = alloc_array(string, upper-lower);
  int i = lower;
  int j = mid;
  int k = 0;

  while (i < mid && j < upper)
  //@loop_invariant lower <= i && i <= mid;
  //@loop_invariant mid <= j && j <= upper;
  //@loop_invariant k == (i - lower) + (j - mid);
  {
    if (A[i] <= A[j]) {
      B[k] = A[i];
      T[k] = S[i];
      i++;
    } else {
      B[k] = A[j];
      T[k] = S[j];
      j++;
    }
    k++;
  }

  //@assert i == mid || j == upper;
  // Warning, loop invariants for these loops have been omitted!
  while (i < mid) { B[k] = A[i]; T[k] = S[i]; i++; k++; }
  while (j < upper) { B[k] = A[j]; T[k] = S[j]; j++; k++; }
  for (k = 0; k < upper-lower; k++) { A[lower+k] = B[k]; S[lower + k] = T[k]; }
}


void sekret_obfuscate_mergesort(int[] A, string[] B, int lower, int upper)
//@requires 0 <= lower && lower <= upper && upper <= \length(A);
//@ensures is_sorted_int(A, lower, upper);
{
  if (upper-lower <= 1) return;
  int mid = lower + (upper-lower)/2;
  sekret_obfuscate_mergesort(A, B, lower, mid);
  sekret_obfuscate_mergesort(A, B, mid, upper);
  sekret_obfuscate_merge(A, B, lower, mid, upper);
  return;
}

void sort_by_freq(string[] vocab, int[] freq, int v)
//@requires v == \length(vocab) && v == \length(freq);
//@ensures is_sorted_int(freq, 0, v);
{
  sekret_obfuscate_mergesort(freq, vocab, 0, v);
}
