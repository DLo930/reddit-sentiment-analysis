#!/usr/bin/python

import os

def go():
   database = {}
   root = "/afs/andrew/course/15/122/labgrades/"

   i = 0
   # Read the files in labgrades as an array
   for filename in os.listdir(root):

      i += 1
      # Only worry about filenames of the form ########.andrewid.####
      try:
         [front,back] = filename.split("@")
         [date,andrewid] = front.split(".")
         [andrew,cmu,edu,time] = back.split(".")
         date = int(date)
         time = int(time)
      except ValueError:
         continue

      if date not in database:
         database[date] = {}

      if andrewid not in database[date] or database[date][andrewid] < time:
         database[date][andrewid] = time

   # Print out one csv per date
   for date, students in database.items():
      csv = open(root+str(date)+".csv", "w")

      for andrewid, time in students.items():
         stufile = open(root+str(date)+"."+andrewid+"@andrew.cmu.edu."+str(time).rjust(6,'0'))
         csv.write(stufile.read())
         stufile.close()

      print "Wrote "+str(date)+".csv, "+str(len(students))+" records"
      csv.close()

go()
