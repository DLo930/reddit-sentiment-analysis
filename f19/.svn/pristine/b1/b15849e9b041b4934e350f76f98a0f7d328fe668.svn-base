export PATH := /usr/local/depot/cc0/bin:$(PATH)
CC0=cc0 lib/*.c0 -o
CC0D=cc0 -d lib/*.c0 -o

default:
	@$(MAKE) extract -s
	@$(MAKE) compile -is
	@$(MAKE) grade -s

.PHONY: extract compile grade
extract:
	date
	echo "[15-122] Extraction..."
	echo "============================================="
	tar -mkxf autograde.tar
	rm -Rf lib
	mv lib-alt lib
	tar -mkxzvf handin.tgz
	echo ""


compile:
	date
	echo "[15-122] Compilation..."
	echo "If your code does not compile on the Autolab server"
	echo "but compiles in your directory, there are three likely culprits"
	echo "(a) you forgot to hand in some new file you created"
	echo "(b) you modified the #use directives when you should not have"
	echo "(c) you didn't respect the stack/queue interface (NOTE: is_stack"
	echo "    AND is_queue ARE NOT PART OF THE INTERFACE)"
	echo "============================================="
	$(CC0)  clac   clac.c0 clac-grade.c0
	$(CC0D) clac-d clac.c0 clac-grade.c0
#	$(CC0D) dict-d dict.c0 dict-grade.c0
#	cc0    -o demo   $(LIB) clac.c0 demo-grade.c0
#	cc0 -d -o demo-d $(LIB) clac.c0 demo-grade.c0
#	cc0    -o dict   dict.c0 dict-grade.c0
#	cc0 -d -o dict-d dict.c0 dict-grade.c0
#	cc0    -o clac   dict-modified.c0 clac.c0 clac-grade.c0
#	cc0 -d -o clac-d dict-modified.c0 clac.c0 clac-grade.c0
	echo ""

grade:
	date
	echo "[15-122] Grading..."
	echo "============================================="
	if [ -e log.clac ];                                     \
	then cat log.clac grade/log-test.clac > log-test.clac;  \
	fi
	python grader.py

# This is for creating the tracing interpreter, which only compiles
# against the alternative library implementation.
clac-ref:
	$(CC0D) clac-ref clac.c0 clac-ref-main.c0
