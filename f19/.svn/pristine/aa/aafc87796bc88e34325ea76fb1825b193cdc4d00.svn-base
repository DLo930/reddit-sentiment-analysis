/* test the correctness of rotate based on provided test images */

#use <img>
#use <parse>
#use <args>
#use <conio>
#use <file>
#use <string>
#use <util>

int main() {
  /* Get args */
  args_t args = args_parse();
  if (args->argc != 2) error("Wrong number of args");

  image_t source = image_load(args->argv[0]);
  if (source == NULL) error("Could not load source");
  int width = image_width(source);
  int height = image_height(source);

  image_t target = image_load(args->argv[1]);
  if (target == NULL) error("Could not load target");
  if (!(2*width == image_width(target))) error("Target has wrong width");
  if (!(2*height == image_height(target))) error("Target has wrong height");

  /* Apply transformation to source */
  pixel_t[] inpixels = image_data(source);
  pixel_t[] outpixels = image_data(target);
  pixel_t[] resultpixels = rotate(inpixels, width, height);
  //@assert resultpixels != inpixels;
  //@assert \length(resultpixels) == \length(outpixels);

  for(int i = 0; i < 4*width*height; i++)
    //@loop_invariant 0 <= i;
    if(outpixels[i] != resultpixels[i]) return 1;

  return 0;
}
