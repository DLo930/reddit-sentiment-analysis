\newpage
\section*{Creating a new linked list%
\TAGS{linked-list, testing}}

Here's the code that creates a new linked list with one non-dummy
node. Suppose \lstinline'linkedlist_new(12)' is called. For each of
lines 4--9 (inclusive) draw a diagram that shows the state of the
linked list after that line executes.  Use \lstinline'X' for struct
fields that we haven't initialized yet.

\begin{lstlisting}[numbers=left]
linkedlist* linkedlist_new(int data)
//@ensures is_linkedlist(\result);
{
    list* p = alloc(struct list_node);
    p->data = data;
    p->next = alloc(struct list_node);
    linkedlist* L = alloc(struct linkedlist_header);
    L->start = p;
    L->end = p->next;
    return L;
}
\end{lstlisting}

\begin{enumerate}[1.]
\setcounter{enumi}{3}
\newcommand{\soldepth}{0in}
\newcommand{\solraise}{-0.58}
\newcommand{\displaysol}[2][0.43]
  {\raisebox{\solraise\height}[0pt][\soldepth]{%
      \includegraphics[width=#1\textwidth]{\img/#2}}}

\item%
  \begin{solution}\displaysol[0.27]{new-4.png}\end{solution}
  \vspace{0.5in}
\item%
  \begin{solution}\displaysol[0.27]{new-5.png}\end{solution}
  \vspace{0.5in}
\item%
  \begin{solution}\displaysol{new-6.png}\end{solution}
  \renewcommand{\soldepth}{0.4in}
  \renewcommand{\solraise}{-0.79}
  \vspace{0.5in}
\item%
  \begin{solution}\displaysol{new-7.png}\end{solution}
  \vspace{0.5in}
\item%
  \begin{solution}\displaysol{new-8.png}\end{solution}
  \vspace{0.5in}
\item%
  \begin{solution}\displaysol{new-9.png}\end{solution}
  \vspace{0.5in}
\end{enumerate}
