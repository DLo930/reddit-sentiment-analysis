#use <conio>
#use "sol-tbuf.c0"

//EXPECT RETURN 0

int main()
{
  bool passed = true;
  tbuf B = tbuf_new_();
  tbuf sol = tbuf_new_();

  //test specifics of delete once
  insert_char_(B, 'a');
  insert_char_(B, 'b');
  insert_char_(B, 'c');
  insert_char_(B, 'd');
  insert_char_(B, 'e');
  insert_char_(B, 'f');
  insert_char_(B, 'g');
  insert_char_(B, 'h');
  insert_char_(B, 'i');
  insert_char_(B, 'j');
  insert_char_(B, 'k');
  insert_char_(B, 'l');
  insert_char_(B, 'm');

  insert_char_(sol, 'a');
  insert_char_(sol, 'b');
  insert_char_(sol, 'c');
  insert_char_(sol, 'd');
  insert_char_(sol, 'e');
  insert_char_(sol, 'f');
  insert_char_(sol, 'g');
  insert_char_(sol, 'h');
  insert_char_(sol, 'i');
  insert_char_(sol, 'j');
  insert_char_(sol, 'k');
  insert_char_(sol, 'l');
  insert_char_(sol, 'm');
  
  for(int i = 0; i < 5; i++) {
    gapbuf_backward_(B->point->data);
    gapbuf_backward_(sol->point->data);
  }

  delete_char(B);
  delete_char_(sol);
  
  // get contents
  contents B_c = tbuf_contents(B);
  contents sol_c = tbuf_contents(sol);

  if (!(B_c->cursor == sol_c->cursor && string_equal(B_c->str, sol_c->str))) {
    passed = false;
    // error("there was a discrepancy in the tbuf after deletion");
  }

  //delete to the front
  for(int i = 0; i < 8; i++) {
    delete_char(B);
    delete_char_(sol);
  }

  // get contents
  B_c = tbuf_contents(B);
  sol_c = tbuf_contents(sol);

  if (!(B_c->cursor == sol_c->cursor && string_equal(B_c->str, sol_c->str))) {
    passed = false;
    // error("deleting off the front broke shit");
  }

  //now clear everything out
  for(int i = 0; i < 197; i++)
    insert_char_(B, 'x');

  for(int i = 0; i < 5; i++)
    forward_char_(B);

  for(int i = 0; i < 216; i++)
    delete_char(B);

  if(!(tbuf_empty_(B) == true)) {
    passed = false;
    // error("didn't make it empty");
  }

  //report
  if(passed) return 0; else return 1;
}
