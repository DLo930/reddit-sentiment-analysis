// Contract exploit: smears out the image in completely the wrong order

pixel[] rotate(pixel[] A, int width, int height)
//@requires is_valid_imagesize(width, height);
//@requires is_valid_imagesize(2*width, 2*height);
//@requires \length(A) == width * height;
//@requires width == height;
//@ensures \length(\result) == 4*width*height;
{
  int off = width*height;
  pixel[] B = alloc_array(pixel, 4*width*height);
  for (int i = 0; i < width*height; i++) {
    B[i + 0*off] = A[i];
    B[i + 1*off] = A[i];
    B[i + 2*off] = A[i];
    B[i + 3*off] = A[i];
  }

  return B;
}