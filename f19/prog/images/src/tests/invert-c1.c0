/* test the correctness of invert based on provided test images */

#use <img>
#use <parse>
#use <args>
#use <conio>
#use <file>
#use <string>

pixel[] invert(pixel[] image, int height, int width, int color, int tolerance);

/* tests if two images a and b are equal */
bool image_equal(image_t a, image_t b) {
		int aheight = image_height(a);
    int bheight = image_height(b);
    if (aheight != bheight)
    {
        return false;
    }

    int awidth = image_width(a);
    int bwidth = image_width(b);
    if (awidth != bwidth)
    {      
        return false;
    }

    pixel[] arra = image_data(a);
    pixel[] arrb = image_data(b);
   
    for(int i = 0; i < awidth*aheight; i++)
    {
        if(arra[i] != arrb[i])
        {
            return false;
        }
    }

		return true;
}

int main() {
    image_t source;
    image_t dest;
    image_t expected_image;
    int width;
    int height;
    int[] inpixels;
    int[] outpixels;
    int[] resultpixels;
    string *output = alloc(string);
    string *input = alloc(string);
    string *expected = alloc(string);
    string type = "invert";
    string[] args;
    bool result = true;
    int i;
  
    *input = "./images/g5.png"; 

    source = image_load(*input);
    width = image_width(source);
    height = image_height(source);

    dest = image_create(width, height);
    inpixels = image_data(source);
    outpixels = image_data(dest);

    *expected = "./images/g5-invert-ff00ff00-150.png";

		expected_image = image_load(*expected);

    resultpixels = invert(inpixels, height, width, 0xff00ff00, 150); 

    for (i = 0; i < width*height; i++)
        outpixels[i] = resultpixels[i];

    if(!image_equal(dest, expected_image))
        result = false;

    image_destroy(dest);
    image_destroy(source);

    if(!result)
	{
		println("TEST FAILED");
        assert(false);
	}

	println("TEST PASSED");
    return 0;
}
