\documentclass[12pt]{exam}
\newcommand{\hwnumber}{3}
\newcommand{\hwname}{Images}
\newcommand{\duedate}{\formatdate{19}{9}{\YEAR} by \progDueTime} % day-month-year

%\newcommand{\hwcolor}{red}   % F18 S17 (upto F15)
%\newcommand{\hwcolor}{green} % S19 F17 S16
\newcommand{\hwcolor}{blue}  %  F19 S18 F16

\newcommand{\hwversion}{reflect-blur} % F19 F18 F17 F16 F15
%\newcommand{\hwversion}{rotate-mask}  % S19 S18 S17 S16

\input{../../inc/preamble.tex}
\begin{document}
\hwTitle

\noindent
This programming assignment will have you using arrays to represent
and manipulate images.

\bigskip
\noindent
The code handout for this assignment is on \autolab{} and at
\begin{center}
\whereisthetgz{images-handout.tgz}
\end{center}
The file \lstinline'README.txt' in the code handout goes over the contents
of the handout and explains how to hand the assignment in.  There is
a FIVE (5) PENALTY-FREE HANDIN LIMIT, with the idea that for each task
you can test your code, hand in, and then fix any bugs found by autolab
while working on and testing the next task. Make sure to leave enough
submissions to work on the optional Task 5, if you wish to do that.
Every additional handin will incur a small (5\%) penalty (even if
using a late day).

\paragraph{Style Grading:}
With this assignment, we will begin to emphasize \emph{programming
  style} more heavily. We will actually be looking at your code and
evaluating it based on the criteria outlined at
\url{http://cs.cmu.edu/~15122/misc/styleguide.pdf}. We will make
comments on your code via Autolab, and will assign an overall passing
or failing style grade. A failing style grade will be temporarily
represented as a score of -15 points.  This -15 will be reset to 0
once you:
\begin{enumerate}
\itemsep=-3pt
\item%
  fix the style issues,
\item%
  see a member of the course staff during office hours \textbf{within
    5 days} after the grades are released, and
\item%
  briefly discuss the style issues and how they were addressed.
\end{enumerate}
We will evaluate your code for style in two ways. We will use
\lstinline'cc0' with the \lstinline'-w' flag that gives style warnings
--- code that raises warnings with this flag is almost certain to fail
style grading. Because the \lstinline'-w' flag does not check for good
variable names, appropriate comments, or appropriate use of the
functions defined in \lstinline'pixel.c0' and
\lstinline'imageutil.c0', these issues will be checked by hand.

\begin{task}[3]
\TAGS{correctness, loop-invariant, safety}
  In addition to using good style, be sure to include appropriate contracts,
  \requires{}, \ensures{}, and \loopinvariant{}. Your annotations should at
  least be sufficient to ensure that all your array accesses are safe, and
  part of your grade will be based on a visual inspection of this.
\end{task}

\section{Image manipulation}

The programming problems you have for this assignment deal with
manipulating images. An image will be stored in a one-dimensional
array of pixels. (The C0 image library assumes the ARGB implementation
of pixels that you wrote last week.) Pixels are stored in the array
row by row, left to right starting at the top left of the image. For
example, if a $5 \times 5$ image has the following pixel ``values'':
$$
\begin{array}{ccccc}
a & b & c & d & e \\
f & g & h & i & j \\
k & l & m & n & o \\
p & q & r & s & t \\
u & v & w & x & y \\
\end{array}
$$
then these values would be stored in the array in this order:
$$
a\ b\ c\ d\ e\ f\ g\ h\ i\ j\ k\ l\ m\ n\ o\ p\ q\ r\ s\ t\ u\ v\ w\ x\ y
$$
In the $5 \times 5$ image, the pixel $i$ is in row 1, column 3 (rows
and columns are indexed starting with 0) but is stored in the one-dimensional
array at index 8. An image must have at least one pixel.

\begin{task}[4]
\TAGS{correctness, safety, testing}
  Complete the C0 file \lstinline'imageutil.c0'. As with the
  \lstinline'pixel.c0' implementation from last week, you must fill in
  the missing code and translate the English preconditions and
  postconditions into \requires{} and \ensures{} statements.
\end{task}

We do not require you to hand in an \lstinline'images-test.c0' file
that tests your \emph{imageutil} implementation the way you tested
your \emph{pixel} implementation. It would be a good idea to write one
to test your own implementation, however!

%  We will compile your program as
% follows:
% \begin{quote}
% \begin{lstlisting}[language={[coin]C}]
% cc0 -d imageutil.c0 imageutil-main.c0
% \end{listing}
% \end{quote}
% using your \lstinline'imageutil.c0' file. Your code must compile using
% these instructions with files shown in the order given.
% We do not distribute a \lstinline|imageutil-main.c0| file; you can check
% that \lstinline|imageutil.c0| compiles using \lstinline|coin|. You are
% encouraged to write your own \lstinline|imageutil-main.c0| file that tests
% \lstinline'imageutil.c0'.  Do NOT include a main function in your
% \lstinline'imageutil.c0' file.

\section{Image Transformations}

The rest of this assignment involves implementing the core part of a
series of image transformations. Each function you write will take an
array representation of the input image and return an array
representation of the output image. These functions should {\it not}
be destructive: you should make your changes in a copy of the array,
and not make any changes to the original array. Your implementations
should be relatively efficient, meaning both that they should have a
reasonable big-O running time and that they should take at most a few
seconds to run on our example images.

Remember that your code should have appropriate preconditions and
postconditions. It is always a precondition that the given width and height
are a valid image size that matches the length of the pixel array passed to
the function. It is always a postcondition that the returned array is a
different array from the one that was passed in, and that this resulting array
has the correct length.

In order to pass style grading, you will be expected to use functions
from the \emph{pixel} interface (the type \lstinline'pixel_t' and
functions \lstinline'get_red', \lstinline'get_green',
\lstinline'get_blue', \lstinline'get_alpha', and
\lstinline'make_pixel') and the \emph{imageutil} interface (the
functions \lstinline'is_valid_imagesize', \lstinline'get_row',
\lstinline'get_column', \lstinline'is_valid_pixel',
\lstinline'get_index') in the next two tasks.  On Autolab, we will
compile your code for tasks 2 and 3 against \emph{our} implementation
of the \emph{pixel} and the \emph{imageutil} interfaces, so you cannot add
new functions to these interfaces.


\paragraph{Testing.}
You should use the provided \lstinline'*-main.c0' files to help you test
your code. The use of these files is described in the
\lstinline'README.txt' in the code handout.

For this assignment, we are providing a program,
\lstinline'imagediff', to help you compare your output images to the
sample images in the handout, optionally saving an image that shows
you exactly where the two images differ. It is in the course directory
on \lstinline'afs', so it is available on any cluster machine or when you
are connected via ssh. For example:
\begin{lstlisting}[language={[coin]C}]
% imagediff -i images/sample.png -j images/my-image.png -o images/diff.png
\end{lstlisting}
This command compares the image \lstinline'images/sample.png' and
\lstinline'images/my-image.png' and creates a visual representation of the
difference in \lstinline'images/diff.png'.


\input{remove-\hwcolor}


\ifdefstring{\hwversion}{rotate-mask}{
\clearpage\input{rotate}
\clearpage\input{mask}
}{}
\ifdefstring{\hwversion}{reflect-blur}{
\clearpage\input{reflect}
\clearpage\input{blur}
}{}

\clearpage
\input{manipulate}

%% Unused
%\input{invert}
%\input{quantize}

\end{document}
