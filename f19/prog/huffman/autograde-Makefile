CC=gcc
CFLAGS=-Wall -Wextra -Werror -Wshadow -std=c99 -pedantic -g
LIB=lib/*.c
GIVEN1=freqtable.c htree.c encode.c bitpacking.c compress.c main.c
GIVEN2=freqtable.c htree.c bitpacking.c our-test-htree.c
GIVEN3=freqtable.c htree.c bitpacking.c test-pack.c


default:
	@$(MAKE) extract -s
	@$(MAKE) compile -is
	@$(MAKE) grade -s

.PHONY: extract compile grade
extract:
	date
	echo "[15-122] Extraction..."
	echo "============================================="
	tar -mkxf autograde.tar
	echo "Extracted autograde.tar"
	tar -mkxvf handin.tgz
	echo ""

compile:
	date
	echo "[15-122] Compilation..."
	echo "============================================="
#task 8
	$(CC) $(CFLAGS) $(LIB) $(GIVEN1) our-huffman.c -o our-huff
	if [ -e huffman.c.hip ];                           \
	then ./our-huff -U -h huffman.c.hip -s huffman.c;  \
	fi
#task 1
	$(CC) $(CFLAGS) -DDEBUG $(LIB) $(GIVEN2) huffman.c \
	    -o test-htree
#task 2
	echo '#include "huffman-rename2-theirs.h"' > huffman2.c
	cat huffman.c >> huffman2.c
	echo '#include "huffman-rename2-ours.h"' > our-huffman2.c
	cat our-huffman.c >> our-huffman2.c
	$(CC) $(CFLAGS) -DDEBUG $(LIB) $(GIVEN1) huffman2.c our-huffman2.c \
	    -o huff2-safe
	$(CC) $(CFLAGS) $(LIB) $(GIVEN1) huffman2.c our-huffman2.c         \
	    -o huff2-fast
#task 4
	echo '#include "huffman-rename3-theirs.h"' > huffman3.c
	cat huffman.c >> huffman3.c
	echo '#include "huffman-rename3-ours.h"' > our-huffman3.c
	cat our-huffman.c >> our-huffman3.c
	$(CC) $(CFLAGS) -DDEBUG $(LIB) $(GIVEN1) huffman3.c our-huffman3.c \
            -o huff3-safe
	$(CC) $(CFLAGS) $(LIB) $(GIVEN1) huffman3.c our-huffman3.c         \
	    -o huff3-fast
#task 5
	echo '#include "huffman-rename4-theirs.h"' > huffman4.c
	cat huffman.c >> huffman4.c
	echo '#include "huffman-rename4-ours.h"' > our-huffman4.c
	cat our-huffman.c >> our-huffman4.c
	$(CC) $(CFLAGS) -DDEBUG $(LIB) $(GIVEN1) huffman4.c our-huffman4.c \
            -o huff4-safe
	$(CC) $(CFLAGS) $(LIB) $(GIVEN1) huffman4.c our-huffman4.c         \
	    -o huff4-fast
#task 3,6-7
	$(CC) $(CFLAGS) -DDEBUG $(LIB) $(GIVEN1) huffman.c \
            -o huff-safe
	$(CC) $(CFLAGS) $(LIB) $(GIVEN1) huffman.c         \
	    -o huff-fast

# task 7
	$(CC) $(CFLAGS) -DDEBUG $(LIB) $(GIVEN3) huffman.c   \
            -o test-pack
	$(CC) $(CFLAGS) $(LIB) $(GIVEN3) huffman.c           \
            -o test-pack-fast

grade:
	date
	echo "[15-122] Grading..."
	echo "============================================="
	python grader.py
